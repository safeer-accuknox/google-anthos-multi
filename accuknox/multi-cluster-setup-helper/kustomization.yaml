apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - cm.yaml
  - job.yaml
  - role-binding.yaml
  - role.yaml
  - sa.yaml

patches:
- patch: |-
    apiVersion: v1
    data:
      clusterNamePrefix: "anthos-testing-multi"                         # cluster name prefix
    kind: ConfigMap
    metadata:
      name: accuknox-multi-cluster-helper

namespace: agents

replacements:
  - source:
      kind: ConfigMap
      name: accuknox-multi-cluster-helper
      fieldPath: data.generatedClusterName
    targets:
      - select:
          kind: ConfigMap
          name: onboarding-vars
        fieldPaths:
          - data.CLUSTER_NAME
          - data.cluster_name