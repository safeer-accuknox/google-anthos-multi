apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
configurations:
- configuration.yaml
resources:
  - namespace.yaml

helmCharts:
  - name: accuknox-agents
    repo: "oci://registry-1.docker.io/accuknox"
    releaseName: agents
    namespace: agents
    version: v0.6.7
    valuesFile: values.yaml

configMapGenerator:
  - name: anthos-test # cluster name
    literals:
      - clusterNameWorkAround=true

replacements:
  - source:
      kind: ConfigMap
      name: anthos-test # cluster name
      fieldPath: metadata.name
    targets:
      - select:
          kind: ConfigMap
          name: onboarding-vars
        fieldPaths:
          - data.CLUSTER_NAME
          - data.cluster_name

namespace: agents